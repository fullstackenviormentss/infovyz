!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.infovyz=n()}(this,function(){"use strict";var t=function(t,n){var e,r=function(t){if(!arguments.length){if("object"==typeof e){var o={};for(var a in e)o[a]=e[a]();return o}return e}if(e=n(t),"object"==typeof e)for(var i in e)r[i]=e[i]};return r(t),r};t.isValid=function(t,n){try{return t(n),!0}catch(t){return!1}},t.boolean=function(n){return t(n,function(t){if("boolean"==typeof t)return t;throw"d is not boolean"})};var n=function(t){return"number"==typeof t&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t};t.int=function(e){return t(e,function(t){if(!n(t))throw"d is not an integer";return t})},t.float=function(n){return t(n,function(t){if("number"!=typeof t)throw"d is not a number";return t})},t.string=function(n){return t(n,function(t){if("string"==typeof t)return t;throw"d is not a string"})},t.collection=function(n){return t(n,function(t){if(t&&t.constructor===Array)return t;throw"not an array"})},t.map=function(n,e){return t(n,function(t){if("object"==typeof t){var n={};for(var r in e)n[r]=e[r](t[r]);return n}throw"not a valid object"})};var e=function(n){return function(e){function r(){var t=k=n.event.transform,e=w.scale(t.k).translate([t.x,t.y])();j.attr("transform",t),j.selectAll("circle").attr("transform",function(t){return"translate("+y(t.geometry.coordinates)+")"}).attr("r",function(n){return l(n.properties.value||1)/t.k}).attr("stroke-width",s/t.k);var r=z.attr("transform",o(e.scale,e.translate)).selectAll("image").data(e,function(t){return t});r.exit().remove(),r.enter().append("image").attr("xlink:href",function(t){return v.url+t[2]+"/"+t[0]+"/"+t[1]+v.extension}).attr("x",function(t){return t[0]*v.factor}).attr("y",function(t){return t[1]*v.factor}).attr("width",v.factor).attr("height",v.factor)}function o(t,n){var e=t/v.factor,r=t%1?Number:Math.round;return"translate("+r(n[0]*t)+","+r(n[1]*t)+") scale("+e+")"}var a=t,i=!0,u=500,f=Math.PI,c=2*f,l=n.scalePow().domain([1,10]).range([3,15]),s=.5,d=n.select(e),p=d.node().clientWidth,m=d.node().clientHeight,h=[p,m],v={url:"https://maps.wikimedia.org/osm-intl/",extension:".png",switchXY:!1,factor:256},y=n.geoMercator().scale(1/c).translate([0,0]),g=n.geoPath().projection(y),w=n.tile().size(h),b=n.zoom().scaleExtent([512,16384]).on("zoom",r),x=d.select("svg");x.empty()&&(x=d.append("svg").classed("infovyz-map",!0).attr("width",p).attr("height",m));var k,z=x.append("g").classed("tiles",!0),j=x.append("g").classed("overlay",!0),E=function(t){return a(t,function(t){var n=a.float(t)();if(n<-90||n>90)throw new Error("latitude must be a number between -90 and 90.");return t})},M=function(t){return a(t,function(t){var n=a.float(t)();if(n<-180||n>180)throw new Error("longitude must be a number between -180 and 180.");return t})},A=function(t){return a.map(t,{id:a.string,longitude:M,latitude:E})},I=function(t){return{type:"FeatureCollection",features:t.map(function(t){return A(t),{type:"Feature",id:t.id,properties:t,geometry:{type:"Point",coordinates:[+t.longitude,+t.latitude]}}})}},P=function(t){var e=d.node().clientWidth,r=d.node().clientHeight,o=u;p===e&&m===r||(p=e,m=r,o=0,x.attr("width",p).attr("height",m)),"undefined"==typeof j.datum()&&(o=0);var a="undefined"!=typeof t?I(t):j.datum(),f=g.bounds(a),c=f[1][0]-f[0][0],h=f[1][1]-f[0][1],v=(f[0][0]+f[1][0])/2,w=(f[0][1]+f[1][1])/2,z=.8*Math.min(p/c,m/h);x.call(b),i||"undefined"!=typeof j.datum()||x.call(b.transform,n.zoomIdentity.translate(p/2,m/2).scale(1024).translate(0,0)),i&&x.transition().duration(o).call(b.transform,n.zoomIdentity.translate(p/2,m/2).scale(z).translate(-v,-w)),j.datum(a);var E="undefined"!=typeof a?a.features:[];l.domain(n.extent(E.map(function(t){return t.properties.value||1})));var M=j.selectAll("circle").data(E,function(t){return t.id});return M.exit().transition().attr("r",0).attr("stroke-width",0).remove(),z=k?k.k:z,M.enter().append("circle").attr("transform",function(t){return"translate("+y(t.geometry.coordinates)+")"}).attr("r",0).attr("stroke-width",0).transition().attr("r",function(t){return l(t.properties.value||1)/z}).attr("stroke-width",s/z),P};return P.panTo=function(t){if("undefined"==typeof t)throw new Error("map.panTo() called without location.");if("undefined"==typeof t.longitude||"undefined"==typeof t.latitude)throw new Error("map.panTo() called without valid location.");var e=y([t.longitude,t.latitude]),r=t.zoom||10;x.transition().duration(u).call(b.transform,n.zoomIdentity.translate(p/2,m/2).scale(1<<r).translate(-e[0],-e[1]))},P.autozoom=function(t){return 0===arguments.length?i:(i=t,P)},P.transitionDuration=function(t){return 0===arguments.length?u:(u=t,P)},P}},r={version:"1.0.0-beta.6",map:e};return r});