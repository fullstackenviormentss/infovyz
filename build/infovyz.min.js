!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.infovyz=n()}(this,function(){"use strict";var t=function(t,n){var e,r=function(t){if(!arguments.length){if("object"==typeof e){var a={};for(var o in e)a[o]=e[o]();return a}return e}if(e=n(t),"object"==typeof e)for(var i in e)r[i]=e[i]};return r(t),r};t.isValid=function(t,n){try{return t(n),!0}catch(t){return!1}},t.boolean=function(n){return t(n,function(t){if("boolean"==typeof t)return t;throw"d is not boolean"})};var n=function(t){return"number"==typeof t&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t};t.int=function(e){return t(e,function(t){if(!n(t))throw"d is not an integer";return t})},t.float=function(n){return t(n,function(t){if("number"!=typeof t)throw"d is not a number";return t})},t.string=function(n){return t(n,function(t){if("string"==typeof t)return t;throw"d is not a string"})},t.collection=function(n){return t(n,function(t){if(t&&t.constructor===Array)return t;throw"not an array"})},t.map=function(n,e){return t(n,function(t){if("object"==typeof t){var n={};for(var r in e)n[r]=e[r](t[r]);return n}throw"not a valid object"})};var e=function(n){return function(e){function r(){var t=k=n.event.transform,e=w.scale(t.k).translate([t.x,t.y])();A.attr("transform",t),A.selectAll("circle.active").attr("transform",function(t){return"translate("+y(t.geometry.coordinates)+")"}).attr("r",function(n){return l(n.properties.value||1)/t.k}).attr("stroke-width",s/t.k);var r=z.attr("transform",a(e.scale,e.translate)).selectAll("image").data(e,function(t){return t});r.exit().remove(),r.enter().append("image").attr("xlink:href",function(t){return v.url+t[2]+"/"+t[0]+"/"+t[1]+v.extension}).attr("x",function(t){return t[0]*v.factor}).attr("y",function(t){return t[1]*v.factor}).attr("width",v.factor).attr("height",v.factor)}function a(t,n){var e=t/v.factor,r=t%1?Number:Math.round;return"translate("+r(n[0]*t)+","+r(n[1]*t)+") scale("+e+")"}var o=t,i=!0,u=500,c=Math.PI,f=2*c,l=n.scalePow().domain([1,10]).range([3,15]),s=.5,d=n.select(e),p=d.node().clientWidth,m=d.node().clientHeight,h=[p,m],v={url:"https://maps.wikimedia.org/osm-intl/",extension:".png",switchXY:!1,factor:256},y=n.geoMercator().scale(1/f).translate([0,0]),g=n.geoPath().projection(y),w=n.tile().size(h),b=n.zoom().scaleExtent([512,16384]).on("zoom",r),x=d.select("svg");x.empty()&&(x=d.append("svg").classed("infovyz-map",!0).attr("width",p).attr("height",m));var k,z=x.append("g").classed("tiles",!0),A=x.append("g").classed("overlay",!0),j=x.append("g").classed("legend",!0),E=function(t){return o(t,function(t){var n=o.float(t)();if(n<-90||n>90)throw new Error("latitude must be a number between -90 and 90.");return t})},M=function(t){return o(t,function(t){var n=o.float(t)();if(n<-180||n>180)throw new Error("longitude must be a number between -180 and 180.");return t})},P=function(t){return o.map(t,{id:o.string,longitude:M,latitude:E})},I=function(t){return{type:"FeatureCollection",features:t.map(function(t){return P(t),{type:"Feature",id:t.id,properties:t,geometry:{type:"Point",coordinates:[+t.longitude,+t.latitude]}}})}},F=function(t){var e=d.node().clientWidth,r=d.node().clientHeight,a=u;p===e&&m===r||(p=e,m=r,a=0,x.attr("width",p).attr("height",m)),"undefined"==typeof A.datum()&&(a=0);var o="undefined"!=typeof t?I(t):A.datum(),c=g.bounds(o),f=c[1][0]-c[0][0],h=c[1][1]-c[0][1],v=(c[0][0]+c[1][0])/2,w=(c[0][1]+c[1][1])/2,z=.8*Math.min(p/f,m/h);x.call(b),i||"undefined"!=typeof A.datum()||x.call(b.transform,n.zoomIdentity.translate(p/2,m/2).scale(1024).translate(0,0)),i&&x.transition().duration(a).call(b.transform,n.zoomIdentity.translate(p/2,m/2).scale(z).translate(-v,-w)),A.datum(o);var E="undefined"!=typeof o?o.features:[],M=n.extent(E.map(function(t){return t.properties.value||1}));l=n.scalePow().domain(M).range([3,15]);var P=A.selectAll("circle").data(E,function(t){return t.id});P.exit().classed("active",!1).transition().attr("r",0).attr("stroke-width",0).remove(),z=k?k.k:z,P.enter().append("circle").classed("active",!0).attr("transform",function(t){return"translate("+y(t.geometry.coordinates)+")"}).attr("r",0).attr("stroke-width",0).transition().attr("r",function(t){return l(t.properties.value||1)/z}).attr("stroke-width",s/z),j.attr("transform","translate("+(p-l(M[1])-10)+","+(m-10)+")");var T=j.selectAll("g").data(M).enter().append("g");return T.append("circle"),j.selectAll("circle").data(M).attr("cy",function(t){return-l(t)}).attr("r",function(t){return l(t)}),T.append("text"),j.selectAll("text").data(M).attr("y",function(t){return-2*l(t)}).attr("dy",function(){return"-.2em"}).text(function(t){return t}),F};return F.panTo=function(t){if("undefined"==typeof t)throw new Error("map.panTo() called without location.");if("undefined"==typeof t.longitude||"undefined"==typeof t.latitude)throw new Error("map.panTo() called without valid location.");var e=y([t.longitude,t.latitude]),r=t.zoom||10;x.transition().duration(u).call(b.transform,n.zoomIdentity.translate(p/2,m/2).scale(1<<r).translate(-e[0],-e[1]))},F.autozoom=function(t){return 0===arguments.length?i:(i=t,F)},F.transitionDuration=function(t){return 0===arguments.length?u:(u=t,F)},F}},r={version:"1.0.0-beta.7",map:e};return r});