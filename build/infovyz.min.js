!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.infovyz=e()}(this,function(){"use strict";var t=function(t){return function(e){function r(){var e=x=t.event.transform,r=g.scale(e.k).translate([e.x,e.y])();z.attr("transform",e),z.selectAll("circle").attr("transform",function(t){return"translate("+h(t.geometry.coordinates)+")"}).attr("r",function(t){return l(t.properties.value||1)/e.k}).attr("stroke-width",u/e.k);var a=k.attr("transform",n(r.scale,r.translate)).selectAll("image").data(r,function(t){return t});a.exit().remove(),a.enter().append("image").attr("xlink:href",function(t){return m.url+t[2]+"/"+t[0]+"/"+t[1]+m.extension}).attr("x",function(t){return t[0]*m.factor}).attr("y",function(t){return t[1]*m.factor}).attr("width",m.factor).attr("height",m.factor)}function n(t,e){var r=t/m.factor,n=t%1?Number:Math.round;return"translate("+n(e[0]*t)+","+n(e[1]*t)+") scale("+r+")"}var a=!0,o=500,i=Math.PI,s=2*i,l=t.scalePow().domain([1,10]).range([3,15]),u=.5,c=t.select(e),d=parseInt(c.style("width").replace("px",""),10),f=parseInt(c.style("height").replace("px",""),10),p=[d,f],m={url:"https://maps.wikimedia.org/osm-intl/",extension:".png",switchXY:!1,factor:256},h=t.geoMercator().scale(1/s).translate([0,0]),y=t.geoPath().projection(h),g=t.tile().size(p),v=t.zoom().scaleExtent([512,16384]).on("zoom",r),w=c.select("svg");w.empty()&&(w=c.append("svg").classed("infovyz-map",!0).attr("width",d).attr("height",f));var x,k=w.append("g").classed("tiles",!0),z=w.append("g").classed("overlay",!0),I=function(t){return{type:"FeatureCollection",features:t.map(function(t){return{type:"Feature",id:t.id,properties:t,geometry:{type:"Point",coordinates:[+t.longitude,+t.latitude]}}})}},b=function(e){var r=parseInt(c.style("width").replace("px",""),10),n=parseInt(c.style("height").replace("px",""),10),i=o;d===r&&f===n||(d=r,f=n,i=0,w.attr("width",d).attr("height",f)),"undefined"==typeof z.datum()&&(i=0);var s="undefined"!=typeof e?I(e):z.datum(),p=y.bounds(s),m=p[1][0]-p[0][0],g=p[1][1]-p[0][1],k=(p[0][0]+p[1][0])/2,M=(p[0][1]+p[1][1])/2,P=.8*Math.min(d/m,f/g);w.call(v),a||"undefined"!=typeof z.datum()||w.call(v.transform,t.zoomIdentity.translate(d/2,f/2).scale(1024).translate(0,0)),a&&w.transition().duration(i).call(v.transform,t.zoomIdentity.translate(d/2,f/2).scale(P).translate(-k,-M)),z.datum(s),l.domain(t.extent(s.features.map(function(t){return t.properties.value||1})));var A=z.selectAll("circle").data(s.features,function(t){return t.id});return A.exit().transition().attr("r",0).attr("stroke-width",0).remove(),P=x?x.k:P,A.enter().append("circle").attr("transform",function(t){return"translate("+h(t.geometry.coordinates)+")"}).attr("r",0).attr("stroke-width",0).transition().attr("r",function(t){return l(t.properties.value||1)/P}).attr("stroke-width",u/P),b};return b.panTo=function(e){if("undefined"==typeof e)throw new Error("map.panTo() called without location.");if("undefined"==typeof e.longitude||"undefined"==typeof e.latitude)throw new Error("map.panTo() called without valid location.");var r=h([e.longitude,e.latitude]),n=e.zoom||10;w.transition().duration(o).call(v.transform,t.zoomIdentity.translate(d/2,f/2).scale(1<<n).translate(-r[0],-r[1]))},b.autozoom=function(t){return 0===arguments.length?a:(a=t,b)},b.transitionDuration=function(t){return 0===arguments.length?o:(o=t,b)},b}},e={version:"1.0.0-beta.5",map:t};return e});