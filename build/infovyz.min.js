!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.infovyz=e()}(this,function(){"use strict";var t=function(t){return function(e){var n=500,r=t.format(".3s"),a=t.select(e),i=function(e){var i=n;0===arguments.length&&(i=0,e=a.selectAll("div.bar-el").data());var o=e.map(function(t){return t.value}),u=200,l=t.scaleLinear().domain([0,t.max(o)]).range([0,u]);e=e.sort(function(t,e){return e.value-t.value});var s=a.selectAll("div.bar-el").data(e,function(t){return t.id});s.exit().remove();var c=s.enter().append("div").attr("class","bar-el");c.append("div").attr("class","bar bar-label").html(function(t){return t.id}),c.append("div").attr("class","bar bar-bar").style("width",function(t){return l(t.value)+"px"}),c.append("div").attr("class","bar bar-value");var f=t.transition().duration(i);c.merge(s).select("div.bar-bar").transition(f).style("width",function(t){return l(t.value)+"px"}),c.merge(s).select("div.bar-value").text(function(t){return r(t.value)}),c.merge(s).order()};return i.transitionDuration=function(t){return 0===arguments.length?n:(n=t,i)},i}},e=function(t,e){if(!Array.isArray(t))throw new Error("arr needs to be an array");if("string"!=typeof e)throw new Error("typeName needs to be string");for(var n=0;n<t.length;n++)if(t[n].typeName===e)return n;return-1},n=[],r=function(t,e){if(1===arguments.length)return r.type(t);var n,a=function(t){if(!arguments.length){if("object"==typeof n){var r={};for(var i in n)r[i]=n[i]();return r}return n}if(n=e(t),"object"==typeof n)for(var o in n)a[o]=n[o]};return a(t),a};r.type=function(){var t,a,i;if(0===arguments.length)throw new Error("av.type requires at least one argument.");if(a=arguments[0],t=e(n,a),1===arguments.length){if(t===-1)throw new Error("type not found");return n[t].type}if(2===arguments.length){if(i=arguments[1],t!==-1)throw new Error("type specification already exists.");if("function"==typeof i)n.push({typeName:a,type:function(t){return r(t,i)}});else{if("object"!=typeof i)throw new Error("argument 2 typeData must be either a function or object.");n.push({typeName:a,type:function(t){return r(t,function(t){if("object"==typeof t){var e={};for(var n in i)e[n]=r.type(i[n])(t[n]);return e}throw"not a valid object"})}})}return r}throw new Error("invalid amount of arguments for av.type()")},r.isValid=function(t,e){try{return t(e),!0}catch(t){return!1}},r.type("boolean",function(t){if("boolean"==typeof t)return t;throw new Error("d is not boolean")});var a=function(t){return"number"==typeof t&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t};r.type("int",function(t){if(!a(t))throw new Error("d is not an integer");return t}),r.type("float",function(t){if("number"!=typeof t)throw"d is not a number";return t}),r.type("string",function(t){if("string"==typeof t)return t;throw"d is not a string"}),r.type("collection",function(t){if(t&&t.constructor===Array)return t;throw"not an array"}),r.type("latitude",function(t){var e=r("float")(t)();if(e<-90||e>90)throw new Error("latitude must be a number between -90 and 90.");return t}),r.type("longitude",function(t){var e=r("float")(t)();if(e<-180||e>180)throw new Error("longitude must be a number between -180 and 180.");return t}),r.type("location",{id:"string",longitude:"longitude",latitude:"latitude"});var i=function(t){return function(e){function n(){var e=A=t.event.transform,n=w.scale(e.k).translate([e.x,e.y])();k.attr("transform",e),k.selectAll("circle.active").attr("transform",function(t){return"translate("+g(t.geometry.coordinates)+")"}).attr("r",function(t){return c(t.properties.value||1)/e.k}).attr("stroke-width",f/e.k);var r=E.attr("transform",a(n.scale,n.translate)).selectAll("image").data(n,function(t){return t});r.exit().remove(),r.enter().append("image").attr("xlink:href",function(t){return h.url+t[2]+"/"+t[0]+"/"+t[1]+h.extension}).attr("x",function(t){return t[0]*h.factor}).attr("y",function(t){return t[1]*h.factor}).attr("width",h.factor).attr("height",h.factor)}function a(t,e){var n=t/h.factor,r=t%1?Number:Math.round;return"translate("+r(e[0]*t)+","+r(e[1]*t)+") scale("+n+")"}var i=!0,o=!0,u=500,l=Math.PI,s=2*l,c=t.scalePow().domain([1,10]).range([3,15]),f=.5,d=t.select(e),p=d.node().clientWidth,v=d.node().clientHeight,m=[p,v],h={url:"https://maps.wikimedia.org/osm-intl/",extension:".png",switchXY:!1,factor:256},g=t.geoMercator().scale(1/s).translate([0,0]),y=t.geoPath().projection(g),w=t.tile().size(m),b=t.zoom().scaleExtent([512,16384]).on("zoom",n),x=d.select("svg");x.empty()&&(x=d.append("svg").classed("infovyz-map",!0).attr("width",p).attr("height",v),o||x.style("pointer-events","none"));var A,E=x.append("g").classed("tiles",!0),k=x.append("g").classed("overlay",!0),z=x.append("g").classed("legend",!0),j=function(t){return{type:"FeatureCollection",features:t.map(function(t){return r("location")(t),{type:"Feature",id:t.id,properties:t,geometry:{type:"Point",coordinates:[+t.longitude,+t.latitude]}}})}},M=function(e){var n=d.node().clientWidth,r=d.node().clientHeight,a=u;p===n&&v===r||(p=n,v=r,a=0,x.attr("width",p).attr("height",v)),"undefined"==typeof k.datum()&&(a=0);var o="undefined"!=typeof e?j(e):k.datum(),l=y.bounds(o),s=l[1][0]-l[0][0],m=l[1][1]-l[0][1],h=(l[0][0]+l[1][0])/2,w=(l[0][1]+l[1][1])/2,E=.8*Math.min(p/s,v/m);x.call(b),i||"undefined"!=typeof k.datum()||x.call(b.transform,t.zoomIdentity.translate(p/2,v/2).scale(1024).translate(0,0)),i&&x.transition().duration(a).call(b.transform,t.zoomIdentity.translate(p/2,v/2).scale(E).translate(-h,-w)),k.datum(o);var N="undefined"!=typeof o?o.features:[],P=t.extent(N.map(function(t){return t.properties.value||1}));c=t.scalePow().domain(P).range([3,15]);var D=k.selectAll("circle").data(N,function(t){return t.id});D.exit().classed("active",!1).transition().attr("r",0).attr("stroke-width",0).remove(),E=A?A.k:E,D.enter().append("circle").classed("active",!0).attr("transform",function(t){return"translate("+g(t.geometry.coordinates)+")"}).attr("r",0).attr("stroke-width",0).transition().attr("r",function(t){return c(t.properties.value||1)/E}).attr("stroke-width",f/E),z.attr("transform","translate("+(p-c(P[1])-10)+","+(v-10)+")");var H=z.selectAll("g").data(P).enter().append("g");return H.append("circle"),z.selectAll("circle").data(P).attr("cy",function(t){return-c(t)}).attr("r",function(t){return c(t)}),H.append("text"),z.selectAll("text").data(P).attr("y",function(t){return-2*c(t)}).attr("dy",function(){return"-.2em"}).text(function(t){return t}),M};return M.panTo=function(e){if("undefined"==typeof e)throw new Error("map.panTo() called without location.");if("undefined"==typeof e.longitude||"undefined"==typeof e.latitude)throw new Error("map.panTo() called without valid location.");var n=g([e.longitude,e.latitude]),r=e.zoom||10;x.transition().duration(u).call(b.transform,t.zoomIdentity.translate(p/2,v/2).scale(1<<r).translate(-n[0],-n[1]))},M.autozoom=function(t){return 0===arguments.length?i:(i=t,M)},M.interactive=function(t){return 0===arguments.length?o:(o=t,o?x.style("pointer-events",null):x.style("pointer-events","none"),M)},M.transitionDuration=function(t){return 0===arguments.length?u:(u=t,M)},M}},o=function(t){return function(e){var n=500,r={top:20,right:20,bottom:30,left:45},a=t.select(e),i=a.node().clientWidth,o=a.node().clientHeight,u=a.select("svg g.viewport"),l=a.select("svg g.viewport g.x.axis"),s=a.select("svg g.viewport g.y.axis");u.empty()&&(u=a.append("svg").classed("infovyz-linechart",!0).attr("width",i).attr("height",o).append("g").attr("class","viewport").attr("transform","translate("+r.left+","+r.top+")"),l=u.append("g").attr("class","x axis"),s=u.append("g").attr("class","y axis"));var c=function(e){var c=n;i=a.node().clientWidth,o=a.node().clientHeight;var f=i-r.left-r.right,d=o-r.top-r.bottom,p=t.scaleTime().rangeRound([0,f]),v=t.scaleLinear().rangeRound([d,0]),m=t.scaleOrdinal(t.schemeCategory10),h=t.line().curve(t.curveBasis).x(function(t){return p(t.date)}).y(function(t){return v(t.value)});0===arguments.length&&(e=a.selectAll("svg g.viewport path.line").data(),c=0),p.domain(t.extent(e.reduce(function(t,e){return e.values.map(function(e){t.push(e.date)}),t},[]))),v.domain([t.min(e,function(e){return t.min(e.values,function(t){return t.value})}),t.max(e,function(e){return t.max(e.values,function(t){return t.value})})]),m.domain(e.map(function(t){return t.id})),a.selectAll("svg").attr("width",i).attr("height",o);var g=t.transition().duration(c),y=t.transition().duration(0).delay(500);l.attr("transform","translate(0,"+d+")").transition(g).call(t.axisBottom(p).ticks(f/75)),s.transition(g).call(t.axisLeft(v).ticks(d/50));var w=u.selectAll("path.line").data(e,function(t){return t.id});w.exit().classed("exit",!0).transition(y).remove(),w.transition(g).attr("d",function(t){return h(t.values)}),w.enter().append("path").attr("class","line").style("stroke",function(t){return m(t.id)}).attr("d",function(t){return h(t.values)})};return c.transitionDuration=function(t){return 0===arguments.length?n:(n=t,c)},c}},u=function(e){return{version:"1.0.0",barchart:t(e),linechart:o(e),map:i(e)}};return u});